---
title: "MongoDB 스터디 9주차(인덱스)"
date: "2021-03-14"
tags: ["MongoDB"]
draft: true
---

# 인덱스

인덱스는 쿼리가 효율적으로 실행되게 돕습니다. 쿼리에 적절한 인덱스가 있으면 이를 사용해 조회할 도큐먼트 수를 줄일 수 있습니다.

인덱스는 특정 필드 또는 필드들을 값에 따라 정렬해 저장합니다.

정렬된 인덱스는 효율적인 레인지 쿼리를 지원합니다.

몽고디비 인덱스는 B-tree 자료구조를 사용합니다.

![](/mongodb/mongodb-study-week-9/index-for-sort.bakedsvg.svg)

## Default `_id` Index

몽고디비는 [_id](https://docs.mongodb.com/manual/core/document/#document-id-field) 필드를 유니크 인덱스를 만듭니다.
`_id` 인덱스는 같은 `_id` 를 가진 두 도큐먼트가 생기는 것을 막습니다. 사용자는 `_id` 인덱스를 제거할 수 없습니다.

> NOTE: 샤딩된 클러스터에서 `_id` 필드를 샤드 키로 사용하지 않으면 오류방지를 위해 애플리케이션이 `_id` 필드의
유니크성을 보장해야 합니다.

## 인덱스 이름

인덱스의 기본 이름은 인덱스 키의 이름과 정렬기준(1 또는 -1)의 합입니다. 예를 들어 `{item: 1, quantity: -1}` 로 인덱스를
만들면 이름은 `item_1_quantity_-1` 입니다.

인덱스를 만들 때 명시적으로 이름을 정할 수도 있습니다.

```javascript
db.products.createIndex(
  { item: 1, quantity: -1 } ,
  { name: "query for inventory" }
)
```

# 인덱스 타입

## 싱글 필드 인덱스

단일 필드 인덱스를 추가할 수 있습니다.

단일 필드 인덱스의 경우 몽고디비가 양방향으로 탐색할 수 있기 때문에 정렬순서(sort order) 는 중요하지 않습니다.

## 컴파운드 인덱스

여러 필드를 포함한 인덱스를 지원합니다.

컴파운드 인덱스에서 필드의 순서는 중요합니다. 예를 들어 `{ userid: 1, score: -1 }` 는, `userid` 로 먼저 정렬된
후, `score` 로  정렬됩니다.

> IMPORTANT: 4.4 버전부터 컴파운드 인덱스는 단 하나의 해시드 인덱스 필드를 가질 수 있습니다.(4.2 버전 이전에는 불가)

### 정렬 순서

컴파운드 인덱스에서 정렬 순서는 중요합니다. 예를 들어 `{ "username" : 1, "date" : -1 }` 인덱스는 
 `sort( { username: 1, date: 1 } )` 를 지원할 수 없습니다.

### 인덱스 프리픽스

인덱스 프리픽스는 인덱스 앞부분 집합입니다.

```javascript
{ "item": 1, "location": 1, "stock": 1 }
```

위 인덱스에서 인덱스 프리픽스는 다음과 같습니다:

- { item: 1 }
- { item: 1, location: 1 }

컴파운드 인덱스는 인덱스 프리픽스를 활용해서 쿼리할 수 있습니다. 하지만 프리픽스가 아닌 필드인 `location` 또는 `stock`
만을 사용했을 때는 인덱스를 활용할 수 없습니다.

### 인덱스 인터섹션
---